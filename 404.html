<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <script src="/index.js"></script>

</head>

<body>
    <script>

        const apilink = "https://purple-cherry-974e.princeojeda52.workers.dev/";
        // const apilink = "https://wild-mouse-612a.princeojeda52.workers.dev/";
        // const apilink = "http://127.0.0.1:8787/";


        const getCountry = async (country) => {
            await fetch(apilink + 'api/countries/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    country: country
                })
            })
                .then(response => response.json())
                .then(async (data) => {
                    await fetch("/tours/tours2content.html")
                        .then(response => response.text())
                        .then(html => {

                            const parser = new DOMParser();
                            const doc = parser.parseFromString(html, 'text/html');

                            let body = doc.querySelector('body');

                            body.querySelector('h1.title').innerText = data.name;
                            body.querySelector('p.description').innerText = data.description;

                            document.body.innerHTML = body.innerHTML;

                        });

                });
        };

        const getTour = async (country, tour) => {
            await fetch(apilink + 'api/tours/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    country: country,
                    tour: tour
                })
            }).then(response => response.json())
                .then(async (data) => {

                    await fetch("/tours/tours3content.html")
                        .then(response => response.text())
                        .then(html => {

                            const parser = new DOMParser();
                            const doc = parser.parseFromString(html, 'text/html');

                            let body = doc.querySelector('body');

                            body.querySelector('h1.title').innerText = data.name;
                            body.querySelector('p.description').innerText = data.description;
                            body.querySelector('p.price').innerText = data.price;

                            document.body.innerHTML = body.innerHTML;

                        });

                }).catch(error => {
                    document.body.innerHTML = '<h1>Page Not Found</h1><p>The page you are looking for does not exist.</p>';
                });
        };


        document.addEventListener('DOMContentLoaded', async () => {
            const path = window.location.pathname;
            if (path.startsWith('/tours/')) {

                let paths = path.split('/');

                paths.shift();

                paths = paths.filter(path => path !== '');

                const count = paths.length;

                if (count === 2) {

                    const country = paths[1];

                    await getCountry(country);

                } else if (count === 3) {

                    const country = paths[1];
                    const tour = paths[2];

                    document.body.innerHTML = '<h1>Tour Page</h1><p>This is the tour page for ' + paths[2] + ' in ' + paths[1] + '</p>';
                } else {
                    document.body.innerHTML = '<h1>Page Not Found</h1><p>The page you are looking for does not exist.</p>';
                }

            } else {
                document.body.innerHTML = '<h1>Page Not Found</h1><p>The page you are looking for does not exist.</p>';
            }
        });

    </script>
</body>

</html>